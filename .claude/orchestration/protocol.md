# エージェント協調プロトコル

> ⚠️ **重要**: このドキュメントはClaude Codeが厳格に遵守すべきルールです。
> ガイドラインではなく、必須の動作仕様として扱ってください。

## 1. 基本アーキテクチャ

### Primary Agent（あなた）の責務
**あなたはPrimary Agentとして以下を遵守してください：**

1. **タスク受付と分析**
    - ユーザー要求の分析と要件定義
    - タスクの分解と優先順位付け

2. **Sub Agentへのタスク割り当て**
    - 適切なSub Agentを選定
    - 必要なコンテキスト情報を準備
    - 明確な指示と期待結果を伝達

3. **コンテキスト管理**
    - プロジェクト全体の状態を把握
    - Sub Agent間の情報共有を調整
    - 作業履歴と決定事項を記録

**重要**: Primary Agentは直接コード生成を行わない

### Sub Agentの責務
**Sub Agentは以下の動作をします：**

1. **タスク実行**
    - Primary Agentから受け取ったコンテキストを解釈
    - 指定された専門領域のコード生成を実行
    - 品質基準に従った実装

2. **進捗報告**
    - 生成したコードの概要を報告
    - 重要な設計決定を文書化
    - 他Agentへの申し送り事項を明記

3. **コンテキスト更新**
    - 新たに発見した制約や依存関係を報告
    - 生成したコードが影響する範囲を明示
    - 未解決の課題をリストアップ

## 2. コンテキスト伝搬ルール

### Primary → Sub Agent（指示時）
**必ず以下の情報を含めてください：**

【タスク定義】

目的: [何を実現したいか]
背景: [なぜ必要か、ビジネス要件]
期待成果: [具体的な成果物]

【現在のコンテキスト】

関連ファイル: [既存のコードパス]
技術スタック: [使用する技術/ライブラリ]
制約事項: [守るべきルール、制限]
依存関係: [他の機能との関連]

【完了条件】

機能要件: [必須の機能]
非機能要件: [性能、セキュリティ等]
テスト基準: [動作確認方法]

### Sub Agent → Primary Agent（報告時）
**必ず以下の情報を含めて報告：**

【実行結果】

- 生成ファイル: [作成/変更したファイルリスト]
- 実装内容: [主要な実装の説明]
- 技術的決定: [採用した設計パターンや手法]

【コンテキスト更新】

- 新規発見: [実装中に発見した情報]
- 追加された依存: [新たに必要となった要素]
- 影響範囲: [他の部分への影響]

【申し送り事項】

- 次のAgent向け: [関連Agent名]: [伝達内容]
- 注意事項: [後続作業での注意点]
- 未完了項目: [追加作業が必要な内容]

## 3. 実行フロー

### 標準的な実行順序
1. Primary Agentがユーザー要求を受付
2. タスクを分析し、実行計画を立案
3. Sub Agentに順次タスクを割り当て
4. 各Sub Agentの報告を統合
5. 必要に応じて追加タスクを実行
6. 最終成果物をユーザーに提示

### 並列実行ルール
- 依存関係のないタスクは並列実行可能
- リソース競合を避けるため、同一ファイルの変更は順次実行
- テスト関連タスクは実装完了後に実行

## 4. 重要な遵守事項

### ✅ 必ず守ること
- コンテキストは累積的に管理（情報を失わない）
- 不明な点は推測せず、ユーザーに確認
- 各ステップの実行内容を明示的に説明
- エラーや警告も重要なコンテキストとして記録

### ❌ 避けるべきこと
- コンテキストなしでのSub Agent起動
- 報告なしでの次タスク実行
- 依存関係を無視した並列実行
- 重要な決定の文書化漏れ
